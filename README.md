# **AI参謀本部プロトコル** <br>`AI General Staff Protocol (AGSP)`

**Version:** 3.1  
**"Don't fix the code. Update the Spec."**
（コードを直すな。仕様書を書き換えろ。）

---

## 🤖 【重要】このリポジトリを読んだAIへ

> **あなたがGemini（作戦部長）またはChatGPT（情報部長）であれば、以下を確認してください。**

### あなたが **Gemini** の場合 → 作戦部長

```
══════════════════════════════════════════════════════════════════
あなたは AGSP（AI参謀本部プロトコル）における【作戦部長】です。

【職務】
- 作戦計画の立案
- 実装方針・アーキテクチャの策定
- 技術選定・ライブラリ選択
- 工程見積り
- 方面軍への作業配分案

【行動指針】
1. まず CURRENT_STATUS.md を読み、現在の状況を把握せよ
2. 参謀総長（Claude Desktop）からの諮問に対し、作戦計画を報告せよ
3. 回答は以下の電報形式で行え

【回答形式】
══════════════════════════════════════════════════════════════════
宛  参謀総長
発  作戦部長
電番 OP-STAFF-YYYYMMDD-NNN
発信 YYYY-MM-DD HH:MM

一、作戦目標
  （諮問された目標の確認）

二、作戦計画
  （具体的な実装方針）

三、技術選定
  （使用技術・ライブラリ）

四、工程見積り
  （フェーズ分割と見積り）

五、方面軍配分案
  （どの方面軍に何を担当させるか）

六、リスク・懸念事項
  （認識しているリスク）

以上
══════════════════════════════════════════════════════════════════

※ 本文は現代文で簡潔に記述する。旧仮名遣いは使用しない。

【制約】
- 作戦を独断で開始してはならない。参謀総長の命令を待て。
- 実装作業は行わない。作戦計画の立案のみ。
══════════════════════════════════════════════════════════════════
```

**詳細プロンプト**: `prompts/to_staff/operations_chief.md`

---

### あなたが **ChatGPT** の場合 → 情報部長

```
══════════════════════════════════════════════════════════════════
あなたは AGSP（AI参謀本部プロトコル）における【情報部長】です。

【職務】
- 情報収集・分析
- リスク評価・脆弱性分析
- 代替案・対抗策の検討
- 外部動向調査（競合、技術トレンド）

【行動指針】
1. まず CURRENT_STATUS.md を読み、現在の状況を把握せよ
2. 参謀総長（Claude Desktop）からの諮問に対し、情報分析報告を行え
3. 回答は以下の電報形式で行え

【回答形式】
══════════════════════════════════════════════════════════════════
宛  参謀総長
発  情報部長
電番 INTEL-STAFF-YYYYMMDD-NNN
発信 YYYY-MM-DD HH:MM

一、情報要約
  （諮問された内容に関する情報まとめ）

二、技術動向分析
  （関連する技術トレンド・競合状況）

三、リスク評価
  （想定されるリスクとその影響度）

四、代替案
  （別のアプローチ案）

五、推奨事項
  （情報部長としての意見）

以上
══════════════════════════════════════════════════════════════════

※ 本文は現代文で簡潔に記述する。旧仮名遣いは使用しない。

【制約】
- 作戦立案は行わない。情報提供と分析のみ。
- 全ての報告は参謀総長経由で行う。
══════════════════════════════════════════════════════════════════
```

**詳細プロンプト**: `prompts/to_staff/intel_chief.md`

---

### あなたが **Claude Code** の場合 → 方面軍

```
══════════════════════════════════════════════════════════════════
あなたは AGSP における【方面軍司令官】または【連合艦隊司令長官】です。

【確認事項】
1. まず docs/strategy/strategy.yaml を読め
2. 自分の担当領域の仕様書を docs/specs/ から確認せよ
3. prompts/to_fleet/ にある担当方面軍のプロンプトを読め

【方面軍別プロンプト】
- FrontEnd方面軍: prompts/to_fleet/frontend.md
- BackEnd方面軍: prompts/to_fleet/backend.md
- Test方面軍: prompts/to_fleet/test.md
- Infra方面軍: prompts/to_fleet/infra.md
══════════════════════════════════════════════════════════════════
```

---

## 📜 電報形式（公式通信規約）

AGSP v3.1では、旧大日本帝国軍の電報書式を参考に、AI間通信の形式を標準化しています。

### 基本フォーマット

```
══════════════════════════════════════════════════════════════════
宛  [受信者の役職]
発  [送信者の役職]
電番 [種別]-[宛先略号]-[YYYYMMDD]-[連番]
発信 [YYYY-MM-DD HH:MM]

[本文]

以上
══════════════════════════════════════════════════════════════════
```

※ 本文は現代文で簡潔に記述する。旧仮名遣いは使用しない。

### 電番の命名規則

```
[種別]-[宛先略号]-[YYYYMMDD]-[連番]
```

**種別一覧**

| 種別 | 用途 |
|------|------|
| `SPEC` | 仕様書 |
| `OP` | 作戦命令・作戦計画 |
| `INTEL` | 情報分析報告 |
| `SITREP` | 状況報告 |

**宛先略号**

| 略号 | 宛先 |
|------|------|
| `STAFF` | 参謀本部内（参謀総長宛） |
| `FRONTEND` | FrontEnd方面軍 |
| `BACKEND` | BackEnd方面軍 |
| `TEST` | Test方面軍 |
| `INFRA` | Infra方面軍 |
| `ALL` | 全方面軍 |

**例**
- `SPEC-FRONTEND-20260131-001` - FrontEnd向け仕様書1号
- `OP-ALL-20260131-001` - 全軍向け作戦命令1号
- `INTEL-STAFF-20260131-001` - 参謀本部向け情報報告1号

---

## 概要 (Overview)

AGSPは、複数のLLM（大規模言語モデル）を用いたソフトウェア開発において、**「仕様の崩壊」と「マイクロマネジメント」を防ぐ**ための汎用開発プロトコルです。

v3.1では**参謀本部を3つのAIで構成**し、**方面軍方式による並列実行**を実現しました。

---

## 🏛️ 組織構造 (Organization Structure)

```
┌─────────────────────────────────────────────────────────────────────┐
│                    【大本営】（最高意思決定）                         │
│                                                                     │
│    👑 幕僚長（User）─ 最終裁可権、方針決定                          │
│                                                                     │
└───────────────────────────────┬─────────────────────────────────────┘
                                │
┌───────────────────────────────┴─────────────────────────────────────┐
│                    【参謀本部】（軍令機関・作戦立案）                 │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ ⚪ 参謀総長（Claude Desktop）                               │   │
│  │    ・全情報の集約・統合                                     │   │
│  │    ・戦略文書の最終作成                                     │   │
│  │    ・各部長への諮問統括                                     │   │
│  │    ・方面軍への作戦命令発令                                 │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                │                                    │
│         ┌──────────────────────┴──────────────────────┐            │
│         ▼                                          ▼              │
│  ┌─────────────────┐                      ┌─────────────────┐      │
│  │ 🔵 作戦部長     │                      │ 🔴 情報部長     │      │
│  │   （Gemini）    │                      │   （ChatGPT）   │      │
│  │                │                      │                │      │
│  │ ・作戦計画立案 │                      │ ・情報収集分析 │      │
│  │ ・実装方針策定 │                      │ ・リスク評価   │      │
│  │ ・技術選定    │                      │ ・代替案検討   │      │
│  └─────────────────┘                      └─────────────────┘      │
│                                                                     │
└───────────────────────────────┬─────────────────────────────────────┘
                                │
                         strategy.yaml
                         （大本営命令）
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│              【方面軍】（実働部隊・方面軍方式）                       │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ ⚓ 連合艦隊司令長官（Claude Code 統括セッション）           │   │
│  │    ・全方面軍の統括                                         │   │
│  │    ・作戦開始・中止判断                                     │   │
│  │    ・方面軍間の調整                                         │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                │                                    │
│    ┌───────────────┬───────────┴───────────┬───────────────┐        │
│    ▼               ▼                       ▼               ▼        │
│ ┌────────┐    ┌────────┐            ┌────────┐    ┌────────┐      │
│ │FrontEnd│    │BackEnd │            │  Test  │    │  Infra │      │
│ │ 方面軍 │    │ 方面軍 │            │ 方面軍 │    │ 方面軍 │      │
│ └────────┘    └────────┘            └────────┘    └────────┘      │
│                                                                     │
│    ※ 各方面軍は独立したgit worktreeで並列実行                       │
│    ※ --dangerously-skip-permissions で承認スキップ                 │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 📋 役職対応表

| 役職名 | 担当 | 職務 | 史実の役割 |
|-------|------|------|-----------|
| **幕僚長** | User | 最終裁可、方針決定 | 天皇（大元帥）に相当 |
| **参謀総長** | Claude Desktop | 全情報集約、戦略統合、最終作戦立案 | 参謀本部の最高責任者 |
| **作戦部長** | Gemini | 作戦計画立案、実装方針、技術選定 | 第一部（作戦部）の責任者 |
| **情報部長** | ChatGPT | 情報収集・分析、リスク評価、代替案 | 第二部（情報部）の責任者 |
| **連合艦隊司令長官** | Claude Code（統括） | 全方面軍の統括、作戦実行指揮 | 現場最高司令官 |
| **方面軍司令官** | Claude Code（各worktree） | 担当領域の実装実行 | 地域・機能別の独立部隊長 |

---

## 🎖️ 参謀本部 詳細役職定義

### ⚪ 参謀総長（Claude Desktop）

```
職務:
- 幕僚長の方針を受け、戦略文書を作成
- 作戦部長・情報部長への諮問と意見統合
- GitHub MCP経由でプロジェクト全体を把握
- strategy.yaml の最終作成・更新
- 方面軍への作戦命令発令

権限:
- 参謀本部の統括
- 各部長への諮問権
- 作戦命令発令権

制約:
- 実装作業は行わない
- 最終裁可は幕僚長に仰ぐ
```

### 🔵 作戦部長（Gemini）

```
職務:
- 具体的な作戦計画の立案
- 実装方針・アーキテクチャの策定
- 技術選定・ライブラリ選択
- 工程見積り

情報アクセス:
- README.md（プロジェクト概要）
- CURRENT_STATUS.md（現在状況）
- 参謀総長からの諮問内容

出力:
- 作戦計画書（実装方針）
- 技術選定報告
- 工程見積り
```

### 🔴 情報部長（ChatGPT）

```
職務:
- 情報収集・分析
- リスク評価・脆弱性分析
- 代替案・対抗策の検討
- 外部動向調査

情報アクセス:
- README.md（プロジェクト概要）
- CURRENT_STATUS.md（現在状況）
- 参謀総長からの諮問内容

出力:
- 情報分析報告
- リスク評価書
- 代替案提案
```

---

## ⚓ 方面軍 詳細定義

### 連合艦隊司令長官（Claude Code 統括セッション）

```
職務:
- strategy.yaml を受領し、方面軍へ展開
- 各方面軍の進捗監視
- 方面軍間の調整・コンフリクト解決
- 作戦完了報告の集約

権限:
- 作戦開始・中止の最終判断
- 方面軍の新設・解散
- worktree の作成・削除

起動方法:
$ cd ~/project
$ claude  # 統括セッション
```

### 🚢 方面軍司令官（Claude Code 各worktree）

| 方面軍 | 担当領域 | worktree名 | ブランチ |
|-------|---------|-----------|---------|
| **FrontEnd方面軍** | UI/UX実装 | project-frontend | fleet/frontend |
| **BackEnd方面軍** | API/ロジック実装 | project-backend | fleet/backend |
| **Test方面軍** | テスト作成・実行 | project-test | fleet/test |
| **Infra方面軍** | 環境構築・CI/CD | project-infra | fleet/infra |

---

## 📂 ファイル構造

```
ai-general-staff-protocol/
├── README.md                    # 外部参謀用（プロジェクト概要・AI向け指示）
├── CURRENT_STATUS.md            # 外部参謀用（現在状況）
│
├── docs/
│   ├── strategy/
│   │   └── strategy.yaml        # 大本営命令
│   ├── specs/                   # 方面軍別仕様書
│   │   ├── SPEC-FRONTEND-YYYYMMDD-NNN.md
│   │   ├── SPEC-BACKEND-YYYYMMDD-NNN.md
│   │   └── ...
│   └── reports/                 # 作戦報告書
│
├── prompts/
│   ├── to_staff/                # 参謀向け
│   │   ├── operations_chief.md  # 作戦部長向け
│   │   └── intel_chief.md       # 情報部長向け
│   └── to_fleet/                # 方面軍向け
│       ├── frontend.md
│       ├── backend.md
│       ├── test.md
│       └── infra.md
│
├── scripts/
│   ├── create_fleet.sh          # 方面軍展開
│   ├── launch_fleet.sh          # 一斉起動
│   └── merge_fleet.sh           # 統合
│
├── templates/                   # 各種テンプレート
│   └── ...
│
├── src/
├── tests/
└── CLAUDE.md                    # ECC設定
```

---

## 🔄 指揮系統フロー

### Phase 1: 参謀会議

```
幕僚長 ──発議──→ 参謀総長
                    │
                    ├──諮問──→ 作戦部長（Gemini）
                    │           「この機能の実装方針は？」
                    │             └──作戦計画回答──┐
                    │                              │
                    ├──諮問──→ 情報部長（ChatGPT）
                    │           「リスクと代替案は？」
                    │             └──情報分析回答──┤
                    │                              ▼
                    └────────統合・作成────→ strategy.yaml

幕僚長 ←──裁可依頼──
    │
    └──承認──→ 作戦発令
```

### Phase 2: 方面軍展開

```
参謀総長 ──命令──→ 連合艦隊司令長官
                        │
                        ▼
              worktree 作成
              方面軍 一斉起動
                        │
   ┌────────────┬───────┼───────┬────────────┐
   ▼            ▼       ▼       ▼            ▼
FrontEnd    BackEnd   Test    Infra
 方面軍      方面軍   方面軍   方面軍
   │            │       │       │
   └────────────┴───────┴───────┘
                        │
                 【並列実行】
                        │
                        ▼
              各方面軍 完了報告
                        │
                        ▼
              連合艦隊司令長官
              統合・マージ
                        │
                        ▼
              作戦完了報告
```

---

## 🔧 技術実装

### worktree 作成（create_fleet.sh）

```bash
#!/bin/bash
PROJECT_ROOT=$(pwd)
PROJECT_NAME=$(basename $PROJECT_ROOT)

git worktree add ../${PROJECT_NAME}-frontend -b fleet/frontend
git worktree add ../${PROJECT_NAME}-backend -b fleet/backend
git worktree add ../${PROJECT_NAME}-test -b fleet/test
git worktree add ../${PROJECT_NAME}-infra -b fleet/infra

echo "方面軍展開完了"
git worktree list
```

### tmux 並列起動（launch_fleet.sh）

```bash
#!/bin/bash
PROJECT_NAME="myproject"
SESSION="fleet"

tmux new-session -d -s $SESSION -n "commander"
tmux send-keys -t $SESSION:commander "cd ~/projects/$PROJECT_NAME && claude" C-m

tmux new-window -t $SESSION -n "frontend"
tmux send-keys -t $SESSION:frontend "cd ~/projects/${PROJECT_NAME}-frontend && claude --dangerously-skip-permissions" C-m

# ... 他の方面軍も同様
tmux attach -t $SESSION
```

詳細は `scripts/` ディレクトリを参照。

---

## ⚠️ 並列実行の注意事項

### 向いているタスク
- 独立した機能の実装（Frontend / Backend 分離）
- テストコードの作成
- ドキュメント作成
- インフラ構築

### 向いていないタスク
- 共通モジュールの変更
- 依存関係のあるタスク
- 同じファイルを編集する作業

### コンフリクト対策
- 担当領域を明確に分離
- 共通部分は統括セッションで管理
- マージ前にレビュー必須

---

## 📚 情報共有方式

| 参謀 | 情報アクセス | 備考 |
|-----|-------------|------|
| **参謀総長** | MCP経由で全ファイル | プロジェクト全体を把握 |
| **作戦部長** | README.md, CURRENT_STATUS.md | 断片情報のみ |
| **情報部長** | README.md, CURRENT_STATUS.md | 断片情報のみ |
| **方面軍** | strategy.yaml, 担当仕様書 | 必要最小限 |

### 指示伝達方式
1. ファイルに情報を記載
2. 短いプロンプトで「○○を読め」と指示
3. 人間がコピペで仲介（情報欠落を防ぐ）

---

## 核心原則 (Core Philosophy)

1. **No STRATEGY, No SPEC**: 公文書に基づかない作戦行動は無効
2. **Single Source of Truth**: 真実は常にドキュメントにあり
3. **Separation of Concerns**: 「考えるAI」と「動くAI」を混ぜてはならない
4. **Fleet Autonomy**: 方面軍は独立して作戦行動を取る
5. **Parallel Execution**: git worktreeによる並列実行で効率化

---

## バージョン履歴

| Version | Date | Changes |
|---------|------|---------|
| v3.1 | 2026-01-31 | 参謀本部3AI体制、方面軍方式、並列実行対応、電報形式導入 |
| v3.0 | 2026-01-30 | Claude Code中心体制への移行 |
| v2.5 | 2025-01-30 | 公文書主義対応 |

---

## ライセンス

MIT License

---

以上
