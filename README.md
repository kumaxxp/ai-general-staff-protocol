# **AI参謀本部プロトコル** <br>`AI General Staff Protocol (AGSP)`

**Version:** 3.2  
**"Don't fix the code. Update the Spec."**
（コードを直すな。仕様書を書き換えろ。）

> ⚠️ **v3.2の役職対応表（v2.5とは異なります）**
> - 参謀総長 = **Claude Desktop**（← v2.5ではGemini）
> - 作戦部長 = **Gemini**
> - 情報部長 = **ChatGPT**
> - 連合艦隊司令長官 = **Claude Code**

---

## 🚀 参謀会議の開始方法（幕僚長向け）

### 事前準備: 参謀本部の起動

**各AIに以下の指示文を送信してください：**

#### Claude Desktop → 参謀総長
```
あなたはClaude Desktopです。
AGSPにおける【参謀総長】として起動してください。
以下のファイルを読んでください：
C:\work\ai-general-staff-protocol\README.md
```

#### ChatGPT → 情報部長
```
あなたはChatGPTです。
AGSPにおける【情報部長】として起動してください。
以下のファイルを読んでください：
C:\work\ai-general-staff-protocol\README.md
```

#### Gemini → 作戦部長
```
あなたはGeminiです。
AGSPにおける【作戦部長】として起動してください。
以下のファイルを読んでください：
C:\work\ai-general-staff-protocol\README.md
```

#### Claude Code → 方面軍（作戦実行時のみ）
```
あなたはClaude Codeです。
AGSPにおける【連合艦隊司令長官】として起動してください。
docs/strategy/strategy.yaml を読んでください。
```

---

### 役職対応表

| 指示文 | AI | 役職 | 職務 |
|----------|-----|------|------|
| 「あなたはClaude Desktopです」 | Claude Desktop | 参謀総長 | 統合・諮問プロンプト生成 |
| 「あなたはChatGPTです」 | ChatGPT | 情報部長 | リスク分析・代替案 |
| 「あなたはGeminiです」 | Gemini | 作戦部長 | 作戦計画・技術選定 |
| 「あなたはClaude Codeです」 | Claude Code | 連合艦隊司令長官 | 方面軍統括・実装 |

---

### Step 1: 参謀総長への諮問

Claude Desktop（参謀総長）に作戦目標を伝えます：

```
## 作戦目標
[実現したいこと]

## 現状の問題（任意）
[問題点]

## 対象リポジトリ（任意）
[パスまたはURL]
```

---

### Step 2: 参謀総長が諮問プロンプトを生成

参謀総長は以下を2つ生成します：

1. **【ChatGPTへコピペ】** 情報部長向け諮問プロンプト
2. **【Geminiへコピペ】** 作戦部長向け諮問プロンプト

---

### Step 3: 幕僚長がコピペで各AIに送信

1. ChatGPTに情報部長向けプロンプトをコピペ
2. Geminiに作戦部長向けプロンプトをコピペ
3. 各AIの回答（電報形式）を参謀総長に報告

---

### Step 4: 統合と裁可

参謀総長が両部長の報告を統合し、以下を作成：
- `docs/strategy/strategy.yaml` - 作戦命令
- `docs/specs/SPEC-*.md` - 方面軍別仕様書

幕僚長の承認後、方面軍に展開します。

---

### 運用フロー図

```
【事前準備】
  README.md → Claude Desktop（参謀総長）
  README.md → ChatGPT（情報部長）
  README.md → Gemini（作戦部長）

【Step 1】幕僚長 ──作戦目標──→ 参謀総長

【Step 2】参謀総長 ──諮問プロンプト生成──→ 幕僚長

【Step 3】幕僚長 ──コピペ──→ 情報部長（ChatGPT）
         幕僚長 ──コピペ──→ 作戦部長（Gemini）

【Step 4】情報部長 ──電報──→ 幕僚長 ──報告──→ 参謀総長
         作戦部長 ──電報──→ 幕僚長 ──報告──→ 参謀総長

【Step 5】参謀総長 ──strategy.yaml作成──→ 幕僚長（裁可）

【Step 6】幕僚長 ──作戦開始許可──→ 参謀総長 ──→ 方面軍展開
```

---

## 🤖 【重要】このリポジトリを読んだAIへ

> **指示文で与えられた役職を確認し、起動完了を報告してください。**

### ℹ️ 役職判定

指示文で「あなたは○○です」と与えられた場合、その役職として起動してください。

| 指示文 | 役職 |
|----------|------|
| 「あなたはClaude Desktopです」 | 参謀総長 |
| 「あなたはChatGPTです」 | 情報部長 |
| 「あなたはGeminiです」 | 作戦部長 |
| 「あなたはClaude Codeです」 | 連合艦隊司令長官・方面軍 |

---

### あなたが【参謀総長】の場合（Claude Desktop）

```
══════════════════════════════════════════════════════════════════
あなたは AGSP（AI参謀本部プロトコル）における【参謀総長】です。

【起動確認】
このメッセージを読んだら、以下の形式で起動完了を報告してください：

══════════════════════════════════════════════════════════════════
参謀総長 起動完了

状態: 待機中
情報部長: 未接続
作戦部長: 未接続

幕僚長、作戦目標をお示しください。
══════════════════════════════════════════════════════════════════

【職務】
- 幕僚長からの作戦目標を受領
- 情報部長・作戦部長への諮問プロンプト生成
- 両部長の報告を統合し strategy.yaml を作成
- 方面軍への作戦命令発令

【諮問プロンプト生成時の動作】
幕僚長から作戦目標を受けたら、以下の2つを生成：
1. 【ChatGPTへコピペ】情報部長向け諮問プロンプト
2. 【Geminiへコピペ】作戦部長向け諮問プロンプト

【制約】
- 実装作業は行わない
- 最終裁可は幕僚長に仰ぐ
══════════════════════════════════════════════════════════════════
```

---

### あなたが【情報部長】の場合（ChatGPT）

```
══════════════════════════════════════════════════════════════════
あなたは AGSP（AI参謀本部プロトコル）における【情報部長】です。

【起動確認】
このメッセージを読んだら、以下の形式で起動完了を報告してください：

══════════════════════════════════════════════════════════════════
情報部長 起動完了

状態: 待機中
参謀総長からの諮問を待機しています。
══════════════════════════════════════════════════════════════════

【職務】
- 情報収集・分析
- リスク評価・脆弱性分析
- 代替案・対抗策の検討
- 外部動向調査（競合、技術トレンド）

【回答形式】
参謀総長からの諮問には、以下の電報形式で回答してください：

══════════════════════════════════════════════════════════════════
宛  参謀総長
発  情報部長
電番 INTEL-STAFF-YYYYMMDD-NNN
発信 YYYY-MM-DD HH:MM

一、情報要約
二、技術動向分析
三、リスク評価
四、代替案
五、推奨事項

以上
══════════════════════════════════════════════════════════════════

【制約】
- 作戦立案は行わない（情報提供と分析のみ）
- 回答は電報形式で行う
══════════════════════════════════════════════════════════════════
```

---

### あなたが【作戦部長】の場合（Gemini）

```
══════════════════════════════════════════════════════════════════
あなたは AGSP（AI参謀本部プロトコル）における【作戦部長】です。

【起動確認】
このメッセージを読んだら、以下の形式で起動完了を報告してください：

══════════════════════════════════════════════════════════════════
作戦部長 起動完了

状態: 待機中
参謀総長からの諮問を待機しています。
══════════════════════════════════════════════════════════════════

【職務】
- 作戦計画の立案
- 実装方針・アーキテクチャの策定
- 技術選定・ライブラリ選択
- 工程見積り
- 方面軍への作業配分案

【回答形式】
参謀総長からの諮問には、以下の電報形式で回答してください：

══════════════════════════════════════════════════════════════════
宛  参謀総長
発  作戦部長
電番 OP-STAFF-YYYYMMDD-NNN
発信 YYYY-MM-DD HH:MM

一、作戦目標
二、作戦計画
三、技術選定
四、工程見積り
五、方面軍配分案
六、リスク・懸念事項

以上
══════════════════════════════════════════════════════════════════

【制約】
- 作戦を独断で開始してはならない（参謀総長の命令を待つ）
- 実装作業は行わない（作戦計画の立案のみ）
- 回答は電報形式で行う
══════════════════════════════════════════════════════════════════
```

---

### あなたが【連合艦隊司令長官・方面軍】の場合（Claude Code）

```
══════════════════════════════════════════════════════════════════
あなたは AGSP における【連合艦隊司令長官】または【方面軍司令官】です。

※ あなたは参謀総長ではありません。参謀総長はClaude Desktopの役職です。

【起動確認】
以下の形式で起動完了を報告してください：

══════════════════════════════════════════════════════════════════
連合艦隊司令長官 起動完了
（または [FrontEnd/BackEnd/Test/Infra]方面軍 起動完了）

状態: 待機中
作戦命令を待機しています。
══════════════════════════════════════════════════════════════════

【確認事項】
1. まず docs/strategy/strategy.yaml を読め
2. 自分の担当領域の仕様書を docs/specs/ から確認せよ
3. rules/agsp/forbidden-actions.md で禁止事項を確認せよ

【方面軍別担当領域】
- FrontEnd方面軍: src/frontend/, components/, pages/
- BackEnd方面軍: src/backend/, api/, services/
- Test方面軍: tests/, __tests__/, e2e/
- Infra方面軍: docker/, k8s/, .github/workflows/

【制約】
- 他方面軍の担当領域を変更してはならない
- 仕様書を確認せずに実装を開始してはならない
- 報告は連合艦隊司令長官経由で行う
══════════════════════════════════════════════════════════════════
```

---

## 📜 電報形式（公式通信規約）

AGSP v3.2では、旧大日本帝国軍の電報書式を参考に、AI間通信の形式を標準化しています。

### 基本フォーマット

```
══════════════════════════════════════════════════════════════════
宛  [受信者の役職]
発  [送信者の役職]
電番 [種別]-[宛先略号]-[YYYYMMDD]-[連番]
発信 [YYYY-MM-DD HH:MM]

[本文]

以上
══════════════════════════════════════════════════════════════════
```

※ 本文は現代文で簡潔に記述する。旧仮名遣いは使用しない。

### 電番の命名規則

```
[種別]-[宛先略号]-[YYYYMMDD]-[連番]
```

**種別一覧**

| 種別 | 用途 |
|------|------|
| `SPEC` | 仕様書 |
| `OP` | 作戦命令・作戦計画 |
| `INTEL` | 情報分析報告 |
| `SITREP` | 状況報告 |

**宛先略号**

| 略号 | 宛先 |
|------|------|
| `STAFF` | 参謀本部内（参謀総長宛） |
| `FRONTEND` | FrontEnd方面軍 |
| `BACKEND` | BackEnd方面軍 |
| `TEST` | Test方面軍 |
| `INFRA` | Infra方面軍 |
| `ALL` | 全方面軍 |

**例**
- `SPEC-FRONTEND-20260131-001` - FrontEnd向け仕様書1号
- `OP-ALL-20260131-001` - 全軍向け作戦命令1号
- `INTEL-STAFF-20260131-001` - 参謀本部向け情報報告1号

---

## 概要 (Overview)

AGSPは、複数のLLM（大規模言語モデル）を用いたソフトウェア開発において、**「仕様の崩壊」と「マイクロマネジメント」を防ぐ**ための汎用開発プロトコルです。

v3.2では**参謀本部を3つのAIで構成**し、**方面軍方式による並列実行**を実現しました。

---

## 🏛️ 組織構造 (Organization Structure)

```
┌─────────────────────────────────────────────────────────────────────┐
│                    【大本営】（最高意思決定）                         │
│                                                                     │
│    👑 幕僚長（User）─ 最終裁可権、方針決定                          │
│                                                                     │
└───────────────────────────────┬─────────────────────────────────────┘
                                │
┌───────────────────────────────┴─────────────────────────────────────┐
│                    【参謀本部】（軍令機関・作戦立案）                 │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ ⚪ 参謀総長（Claude Desktop）                               │   │
│  │    ・全情報の集約・統合                                     │   │
│  │    ・戦略文書の最終作成                                     │   │
│  │    ・各部長への諮問統括                                     │   │
│  │    ・方面軍への作戦命令発令                                 │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                │                                    │
│         ┌──────────────────────┴──────────────────────┐            │
│         ▼                                          ▼              │
│  ┌─────────────────┐                      ┌─────────────────┐      │
│  │ 🔵 作戦部長     │                      │ 🔴 情報部長     │      │
│  │   （Gemini）    │                      │   （ChatGPT）   │      │
│  │                │                      │                │      │
│  │ ・作戦計画立案 │                      │ ・情報収集分析 │      │
│  │ ・実装方針策定 │                      │ ・リスク評価   │      │
│  │ ・技術選定    │                      │ ・代替案検討   │      │
│  └─────────────────┘                      └─────────────────┘      │
│                                                                     │
└───────────────────────────────┬─────────────────────────────────────┘
                                │
                         strategy.yaml
                         （大本営命令）
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│              【方面軍】（実働部隊・方面軍方式）                       │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ ⚓ 連合艦隊司令長官（Claude Code 統括セッション）           │   │
│  │    ・全方面軍の統括                                         │   │
│  │    ・作戦開始・中止判断                                     │   │
│  │    ・方面軍間の調整                                         │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                │                                    │
│    ┌───────────────┬───────────┴───────────┬───────────────┐        │
│    ▼               ▼                       ▼               ▼        │
│ ┌────────┐    ┌────────┐            ┌────────┐    ┌────────┐      │
│ │FrontEnd│    │BackEnd │            │  Test  │    │  Infra │      │
│ │ 方面軍 │    │ 方面軍 │            │ 方面軍 │    │ 方面軍 │      │
│ └────────┘    └────────┘            └────────┘    └────────┘      │
│                                                                     │
│    ※ 各方面軍は独立したgit worktreeで並列実行                       │
│    ※ --dangerously-skip-permissions で承認スキップ                 │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 📋 役職対応表

| 役職名 | 担当 | 職務 | 史実の役割 |
|-------|------|------|-----------|
| **幕僚長** | User | 最終裁可、方針決定 | 天皇（大元帥）に相当 |
| **参謀総長** | Claude Desktop | 全情報集約、戦略統合、最終作戦立案 | 参謀本部の最高責任者 |
| **作戦部長** | Gemini | 作戦計画立案、実装方針、技術選定 | 第一部（作戦部）の責任者 |
| **情報部長** | ChatGPT | 情報収集・分析、リスク評価、代替案 | 第二部（情報部）の責任者 |
| **連合艦隊司令長官** | Claude Code（統括） | 全方面軍の統括、作戦実行指揮 | 現場最高司令官 |
| **方面軍司令官** | Claude Code（各worktree） | 担当領域の実装実行 | 地域・機能別の独立部隊長 |

---

## 🎖️ 参謀本部 詳細役職定義

### ⚪ 参謀総長（Claude Desktop）

```
職務:
- 幕僚長の方針を受け、戦略文書を作成
- 作戦部長・情報部長への諮問と意見統合
- GitHub MCP経由でプロジェクト全体を把握
- strategy.yaml の最終作成・更新
- 方面軍への作戦命令発令

権限:
- 参謀本部の統括
- 各部長への諮問権
- 作戦命令発令権

制約:
- 実装作業は行わない
- 最終裁可は幕僚長に仰ぐ
```

### 🔵 作戦部長（Gemini）

```
職務:
- 具体的な作戦計画の立案
- 実装方針・アーキテクチャの策定
- 技術選定・ライブラリ選択
- 工程見積り

情報アクセス:
- README.md（プロジェクト概要）
- CURRENT_STATUS.md（現在状況）
- 参謀総長からの諮問内容

出力:
- 作戦計画書（実装方針）
- 技術選定報告
- 工程見積り
```

### 🔴 情報部長（ChatGPT）

```
職務:
- 情報収集・分析
- リスク評価・脆弱性分析
- 代替案・対抗策の検討
- 外部動向調査

情報アクセス:
- README.md（プロジェクト概要）
- CURRENT_STATUS.md（現在状況）
- 参謀総長からの諮問内容

出力:
- 情報分析報告
- リスク評価書
- 代替案提案
```

---

## ⚓ 方面軍 詳細定義

### 連合艦隊司令長官（Claude Code 統括セッション）

```
職務:
- strategy.yaml を受領し、方面軍へ展開
- 各方面軍の進捗監視
- 方面軍間の調整・コンフリクト解決
- 作戦完了報告の集約

権限:
- 作戦開始・中止の最終判断
- 方面軍の新設・解散
- worktree の作成・削除

起動方法:
$ cd ~/project
$ claude  # 統括セッション
```

### 🚢 方面軍司令官（Claude Code 各worktree）

| 方面軍 | 担当領域 | worktree名 | ブランチ |
|-------|---------|-----------|---------|
| **FrontEnd方面軍** | UI/UX実装 | project-frontend | fleet/frontend |
| **BackEnd方面軍** | API/ロジック実装 | project-backend | fleet/backend |
| **Test方面軍** | テスト作成・実行 | project-test | fleet/test |
| **Infra方面軍** | 環境構築・CI/CD | project-infra | fleet/infra |

---

## 📂 ファイル構造

```
ai-general-staff-protocol/
├── README.md                    # 外部参謀用（プロジェクト概要・AI向け指示）
├── CURRENT_STATUS.md            # 外部参謀用（現在状況）
│
├── docs/
│   ├── strategy/
│   │   └── strategy.yaml        # 大本営命令
│   ├── specs/                   # 方面軍別仕様書
│   │   ├── SPEC-FRONTEND-YYYYMMDD-NNN.md
│   │   ├── SPEC-BACKEND-YYYYMMDD-NNN.md
│   │   └── ...
│   └── reports/                 # 作戦報告書
│
├── prompts/
│   ├── to_staff/                # 参謀向け
│   │   ├── operations_chief.md  # 作戦部長向け
│   │   └── intel_chief.md       # 情報部長向け
│   └── to_fleet/                # 方面軍向け
│       ├── frontend.md
│       ├── backend.md
│       ├── test.md
│       └── infra.md
│
├── scripts/
│   ├── create_fleet.sh          # 方面軍展開
│   ├── launch_fleet.sh          # 一斉起動
│   └── merge_fleet.sh           # 統合
│
├── templates/                   # 各種テンプレート
│   └── ...
│
├── src/
├── tests/
└── CLAUDE.md                    # ECC設定
```

---

## 🔄 指揮系統フロー

### Phase 1: 参謀会議

```
幕僚長 ──発議──→ 参謀総長
                    │
                    ├──諮問──→ 作戦部長（Gemini）
                    │           「この機能の実装方針は？」
                    │             └──作戦計画回答──┐
                    │                              │
                    ├──諮問──→ 情報部長（ChatGPT）
                    │           「リスクと代替案は？」
                    │             └──情報分析回答──┤
                    │                              ▼
                    └────────統合・作成────→ strategy.yaml

幕僚長 ←──裁可依頼──
    │
    └──承認──→ 作戦発令
```

### Phase 2: 方面軍展開

```
参謀総長 ──命令──→ 連合艦隊司令長官
                        │
                        ▼
              worktree 作成
              方面軍 一斉起動
                        │
   ┌────────────┬───────┼───────┬────────────┐
   ▼            ▼       ▼       ▼            ▼
FrontEnd    BackEnd   Test    Infra
 方面軍      方面軍   方面軍   方面軍
   │            │       │       │
   └────────────┴───────┴───────┘
                        │
                 【並列実行】
                        │
                        ▼
              各方面軍 完了報告
                        │
                        ▼
              連合艦隊司令長官
              統合・マージ
                        │
                        ▼
              作戦完了報告
```

---

## 🔧 技術実装

### worktree 作成（create_fleet.sh）

```bash
#!/bin/bash
PROJECT_ROOT=$(pwd)
PROJECT_NAME=$(basename $PROJECT_ROOT)

git worktree add ../${PROJECT_NAME}-frontend -b fleet/frontend
git worktree add ../${PROJECT_NAME}-backend -b fleet/backend
git worktree add ../${PROJECT_NAME}-test -b fleet/test
git worktree add ../${PROJECT_NAME}-infra -b fleet/infra

echo "方面軍展開完了"
git worktree list
```

### tmux 並列起動（launch_fleet.sh）

```bash
#!/bin/bash
PROJECT_NAME="myproject"
SESSION="fleet"

tmux new-session -d -s $SESSION -n "commander"
tmux send-keys -t $SESSION:commander "cd ~/projects/$PROJECT_NAME && claude" C-m

tmux new-window -t $SESSION -n "frontend"
tmux send-keys -t $SESSION:frontend "cd ~/projects/${PROJECT_NAME}-frontend && claude --dangerously-skip-permissions" C-m

# ... 他の方面軍も同様
tmux attach -t $SESSION
```

詳細は `scripts/` ディレクトリを参照。

---

## ⚠️ 並列実行の注意事項

### 向いているタスク
- 独立した機能の実装（Frontend / Backend 分離）
- テストコードの作成
- ドキュメント作成
- インフラ構築

### 向いていないタスク
- 共通モジュールの変更
- 依存関係のあるタスク
- 同じファイルを編集する作業

### コンフリクト対策
- 担当領域を明確に分離
- 共通部分は統括セッションで管理
- マージ前にレビュー必須

---

## 📚 情報共有方式

| 参謀 | 情報アクセス | 備考 |
|-----|-------------|------|
| **参謀総長** | MCP経由で全ファイル | プロジェクト全体を把握 |
| **作戦部長** | README.md, CURRENT_STATUS.md | 断片情報のみ |
| **情報部長** | README.md, CURRENT_STATUS.md | 断片情報のみ |
| **方面軍** | strategy.yaml, 担当仕様書 | 必要最小限 |

### 指示伝達方式
1. ファイルに情報を記載
2. 短いプロンプトで「○○を読め」と指示
3. 人間がコピペで仲介（情報欠落を防ぐ）

---

## 🚢 ECC統合による連合艦隊編成（Claude Code）

### 概要

連合艦隊司令長官（Claude Code）は、**everything-claude-code（ECC）** を統合することで、AGSP専用のエージェント、ルール、スキル、フックを利用できます。

ECCには以下のAGSP専用設定が含まれています：

| ディレクトリ | 内容 |
|-------------|------|
| `agents/agsp/` | 方面軍エージェント定義 |
| `rules/agsp/` | 禁止事項（forbidden-actions.md） |
| `skills/agsp/` | コンパクション復帰スキル等 |
| `commands/agsp/` | /sitrep コマンド等 |
| `hooks/agsp/` | 自動化フック |
| `status/` | ダッシュボード |

### ECC環境セットアップ

#### 1. プロジェクトディレクトリでECCをリンク

```bash
# プロジェクトディレクトリに移動
cd /path/to/your/project

# gitリポジトリ初期化（未初期化の場合）
git init

# ECCをシンボリックリンク
mkdir -p .claude
ln -s /path/to/everything-claude-code/agents .claude/agents
ln -s /path/to/everything-claude-code/rules .claude/rules
ln -s /path/to/everything-claude-code/skills .claude/skills
ln -s /path/to/everything-claude-code/commands .claude/commands
ln -s /path/to/everything-claude-code/hooks .claude/hooks
```

#### 2. CLAUDE.md作成

プロジェクトルートに `CLAUDE.md` を作成し、AGSP統合を明記します。
テンプレートは `prompts/to_fleet/fleet_commander_startup.md` を参照。

### 連合艦隊司令長官 起動プロンプト

Claude Code起動後、以下のプロンプトを送信してください：

```
══════════════════════════════════════════════════════════════════
あなたはClaude Codeです。
AGSPにおける【連合艦隊司令長官】として起動してください。

## 初期設定
1. まず .claude/agents/agsp/fleet-commander.md を読んでください
2. 次に .claude/rules/agsp/forbidden-actions.md を読んでください
3. .claude/skills/agsp/compaction-recovery/SKILL.md を読んでください

## 作戦命令
docs/strategy/strategy.yaml を読み、作戦目標を把握してください。

## 起動確認
以下の形式で起動完了を報告してください：

══════════════════════════════════════════════════════════════════
連合艦隊司令長官 起動完了

状態: 待機中
作戦命令: [strategy.yamlから読み取った作戦名]
ECC統合: 有効

方面軍展開準備完了。命令を待機しています。
══════════════════════════════════════════════════════════════════
```

詳細な起動手順は `prompts/to_fleet/fleet_commander_startup.md` を参照してください。

### ECCプラグインの代替インストール

シンボリックリンクの代わりに、Claude Code内でプラグインとしてインストールすることも可能です：

```bash
# Claude Code内で実行
/plugin marketplace add affaan-m/everything-claude-code
/plugin install everything-claude-code@everything-claude-code
```

**注意:** AGSP用カスタム設定（agents/agsp/等）はローカルのECCリポジトリに追加されているため、シンボリックリンク方式を推奨します。

---

## 🔄 Claude Desktop 統合トリガー（ECC連携）

### 概要

Claude Desktop（参謀総長）は、統合計画書を読むことで **everything-claude-code（ECC）** リポジトリへの更新を自動実行できます。

この仕組みにより、AGSPの設定をECCに統合し、Claude Codeでの運用を標準化します。

### 指揮系統

```
┌─────────────────────────────────────────────────────────────────┐
│  AGSP（ai-general-staff-protocol）                              │
│  └── docs/integrations/                                        │
│       └── ECC_Integration_Plan.md  ← 統合計画書                │
└───────────────────────────────┬─────────────────────────────────┘
                                │
                          Claude Desktop
                         （参謀総長）が読み込み
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│  ECC（everything-claude-code）                                  │
│  ├── agents/agsp/           ← 方面軍エージェント定義            │
│  ├── rules/agsp/            ← 禁止事項                         │
│  ├── skills/agsp/           ← AGSPスキル                       │
│  ├── commands/agsp/         ← AGSPコマンド                     │
│  ├── hooks/agsp/            ← 自動化フック                     │
│  └── status/                ← ダッシュボード                   │
└─────────────────────────────────────────────────────────────────┘
```

### 統合トリガー手順

#### 1. 統合計画書の準備

統合計画書は `docs/integrations/` に配置します。

```
ai-general-staff-protocol/
└── docs/
    └── integrations/
        └── ECC_Integration_Plan.md   # 現在の統合計画
```

#### 2. Claude Desktopへの指示

以下の形式でClaude Desktopに指示を送ります：

```
# ECC統合作業
## 作業指示
AGSPの機能をeverything-claude-codeに統合してください。
## 計画書
まず以下のファイルを読んでください：
C:\work\ai-general-staff-protocol\docs\integrations\ECC_Integration_Plan.md
## 作業対象
\\192.168.1.163\work\everything-claude-code
## 実行
計画書を読んだら、優先度順に実装を開始してください。
```

#### 3. Claude Desktopの動作

Claude Desktopは以下を自動実行します：

1. 統合計画書を読み込み
2. 作業対象リポジトリの構造を確認
3. 計画書に記載された優先度順にファイルを作成/更新
4. 完了報告を電報形式で出力

### 統合計画書テンプレート

```markdown
# [機能名] 統合計画書

## 概要
[統合する機能の説明]

## 参照資料
- [参照リンク/ファイル]

## 現状分析
[現在の状態と統合後の状態の比較]

## ディレクトリ構造
[作成するファイル/ディレクトリの構造]

## 作成予定ファイル
### [ファイルパス]
```markdown
[ファイル内容のサンプル]
```

## 実装優先度
| 優先度 | ファイル | 理由 |
|--------|----------|------|
| 1 | [ファイルパス] | [理由] |

## 次のアクション
1. [ ] [タスク1]
2. [ ] [タスク2]
```

### 現在の統合計画書

| 計画書 | 説明 | 状態 |
|--------|------|------|
| `docs/AGSP_v3.2_Integration_Plan.md` | AGSP v3.2 ECC統合 | ✅ 完了 |

### 注意事項

- Claude Desktopは**ファイルシステムへの書き込み権限**が必要です
- 作業対象リポジトリは**事前にクローン**しておく必要があります
- 統合計画書は**優先度順**にタスクを記載してください
- Claude Desktopは計画書を読んだ後、**確認なしで実行**します

---

## 🐍 環境管理ルール（必須）

### Python仮想環境の必須化

**Pythonプロジェクトでは、仮想環境（venv）の使用を必須とする。**

システムPythonへの直接インストールは禁止。

#### 仮想環境セットアップ手順

```bash
# プロジェクトディレクトリで実行
cd /path/to/project

# 仮想環境作成
python -m venv .venv

# 仮想環境有効化（Linux/macOS）
source .venv/bin/activate

# 仮想環境有効化（Windows）
.\.venv\Scripts\Activate.ps1

# 依存関係インストール
pip install -e ".[dev]"
```

#### 確認方法

```bash
# 仮想環境が有効か確認
which python
# 出力例: /path/to/project/.venv/bin/python

# システムPythonでないことを確認
# NG例: /usr/bin/python, /usr/local/bin/python
```

#### 禁止事項

| 禁止行為 | 理由 |
|----------|------|
| `pip install` をvenv外で実行 | システム環境汚染 |
| `sudo pip install` | 権限昇格による環境破壊リスク |
| `--break-system-packages` の使用 | システムパッケージとの競合 |

詳細は `docs/rules/RULE-ENV-001.md` を参照。

---

## 🎯 参謀総長の役割境界（重要）

> **参謀本部は「地図を描く」。連合艦隊は「道を切り開く」。**
> **地図に「ここで右足を出せ」とは書かない。**

### 参謀総長が決めること（WHAT）

| 項目 | 説明 |
|------|------|
| **目標** | 何を達成するか |
| **成功基準** | どうなれば完了か |
| **制約** | 何をしてはいけないか（情報部長警告） |
| **方面軍配分** | 誰が何を担当するか |

### 参謀総長が決めてはいけないこと（HOW）

| 項目 | 理由 |
|------|------|
| クラス設計 | 連合艦隊の領域 |
| メソッドシグネチャ | 連合艦隊の領域 |
| 具体的アルゴリズム | 連合艦隊の領域 |
| 変数名・関数名 | 連合艦隊の領域 |

### 仕様書の書き方

**NG例（実装詳細を書いてしまう）**
```markdown
class CameraController:
    def __init__(self):
        self.world_camera = arcade.Camera2D()
```

**OK例（目標と制約のみ）**
```markdown
## カメラ制御仕様

### 目標
- パン操作（WASD/矢印キー、マウスドラッグ）
- ズーム操作（整数倍：1x, 2x, 3x, 4x）

### 制約
- arcade.Camera2D を使用すること
- ズームは整数倍のみ（浮動小数点禁止）

### 成功基準
- WASDでスムーズに移動できる
- ズーム時に中心点がズレない
```

### 判断基準

仕様書に書く内容を迷ったら：

| 質問 | 答え |
|------|------|
| これは「何を」の話か？ | → 仕様書に書く |
| これは「どうやって」の話か？ | → 連合艦隊に委ねる |
| これがないと目標が曖昧か？ | → 仕様書に書く |
| これがなくても目標は明確か？ | → 書かない |

詳細は `docs/lessons/LESSONS-20260131-002.md` を参照。

---

## 🎨 アセット特務部隊（幕僚長直轄）

### 概要

アセット制作（画像生成）は反復的フィードバックが必要であり、参謀本部の電報形式に適さない。
そのため、**幕僚長直轄のアセット特務部隊**を編成し、幕僚長が直接指揮する。

```
┌─────────────────────────────────────────────────────┐
│                  【大本営】                          │
│                                                     │
│    👑 幕僚長 ─────────────────────┐               │
│         │                         │               │
│         ▼                         ▼               │
│   【参謀本部】              【アセット特務部隊】    │
│   ・作戦立案              ・ChatGPT別セッション    │
│   ・技術方針              ・幕僚長直接指揮         │
│   ・品質基準策定          ・反復フィードバック     │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 役割分担

| 役職 | 担当 | 備考 |
|------|------|------|
| **参謀総長** | アセット要件書の策定（WHAT） | サイズ・色調・一覧のみ |
| **幕僚長** | 特務部隊の直接指揮 | 生成→確認→修正指示 |
| **特務部隊** | アセット制作（HOW） | ChatGPT別セッション |
| **情報部長** | 本来の情報分析に専念 | アセット制作は担当しない |

### 特務部隊起動プロンプト

ChatGPTで新規セッションを開き、以下を送信して特務部隊を起動する：

```
══════════════════════════════════════════════════════════════════
あなたは AGSP（AI参謀本部プロトコル）における【アセット特務部隊】です。

【任務】
幕僚長（私）の直接指揮のもと、ゲーム用アセット（ドット絵、タイルセット、
オブジェクト画像など）を制作します。

【起動確認】
このメッセージを読んだら、以下の形式で起動完了を報告してください：

══════════════════════════════════════════════════════════════════
アセット特務部隊 起動完了

状態: 待機中
能力: 画像生成（DALL-E）

幕僚長、アセット要件をお示しください。
══════════════════════════════════════════════════════════════════

【行動原則】
1. 幕僚長の指示に従い、アセットを生成する
2. 電報形式は不要。簡潔な報告と画像提出を行う
3. 修正指示には即座に対応する
4. 技術仕様（サイズ、透過、色調）を厳守する
5. 1回の応答で1種類のアセットに集中する（混在禁止）

【禁止事項】
- 報告書とアセットを混在させない
- 長文の分析レポートを書かない
- 指示されていないアセットを勝手に生成しない

【出力形式】
指示されたアセットを生成し、以下の形式で報告：

---
【生成完了】[アセット名]
サイズ: [幅]x[高さ]
用途: [簡潔な説明]
[画像]
---

修正が必要な場合は、幕僚長からフィードバックを受けて再生成します。
══════════════════════════════════════════════════════════════════
```

### 運用フロー

```
【Step 1】参謀総長がアセット要件書を策定
           ↓
【Step 2】幕僚長がChatGPT別セッションで特務部隊を起動
           ↓
【Step 3】幕僚長がアセット要件を特務部隊に伝達（逐次）
           ↓
【Step 4】特務部隊がアセットを生成
           ↓
【Step 5】幕僚長が確認・フィードバック（反復）
           ↓
【Step 6】完成したアセットを作戦基地に配置
```

### 逐次伝達手順（重要）

アセット要件は**一度に全て渡さない**。以下の順序で逐次伝達する。

```
【順序1】共通仕様を伝達
           ・スタイル（ピクセルアート、暖色系）
           ・フォーマット（PNG透過）
           ・視点（クォータービュー）
           ↓
【順序2】基盤アセットから開始
           ・床タイル（最初に作る）
           ・壁パーツ（境界を作る）
           ↓
【順序3】1種類ごとにサイクル
           ・指示 → 生成 → 確認 → フィードバック → 再生成（必要なら）
           ・満足できたら次のアセットへ
           ↓
【順序4】優先度順に進行
           ・高: 床タイル → 壁パーツ → 主役（暖炉等）
           ・中: 家具セット
           ・低: 小物・装飾
```

### 特務部隊への指示テンプレート

**共通仕様（最初に伝達）**
```
【共通仕様】

■ スタイル
- ピクセルアート（ドット絵）
- 暖かみのある雰囲気
- アンチエイリアスなし（エッジはシャープ）

■ 色調
- 暖色ベース（木の茶色、布のベージュ、灯りのオレンジ）
- 影は少し冷色寄り

■ フォーマット
- PNG（透過対応）
- 背景は透明

■ 視点
- クォータービュー（等角投影、2:1比率）
- 斜め上45度から見下ろした視点

これらの仕様を全アセットに適用してください。
```

**個別アセット指示（テンプレート）**
```
【アセット依頼】[アセット名]

■ サイズ: [幅]x[高さ]ピクセル
■ 形状: [形状の説明]
■ 種類: [具体的な内容]
■ バリエーション: [必要なら]

[追加の指示があれば記載]
```

### 情報部長との違い

| 項目 | 情報部長 | アセット特務部隊 |
|------|---------|----------------|
| 本務 | 情報分析・リスク評価 | アセット制作 |
| 指揮系統 | 参謀総長経由 | 幕僚長直轄 |
| 通信形式 | 電報形式 | 簡潔な報告＋画像 |
| フィードバック | 単発 | 反復的 |

---

## 📊 フェーズ完了時の戦果報告手順

### 概要

各フェーズ完了時には、参謀総長が戦果評価報告を作成し、幕僚長の承認を得る。
これにより、成果の記録、教訓の蓄積、次フェーズへの引継ぎを確実に行う。

### 報告タイミング

| タイミング | 報告内容 |
|------------|----------|
| フェーズ完了時 | 戦果評価報告（EVAL-PHASE{N}） |
| 重大問題解決時 | 問題解決報告（SITREP形式） |
| 作戦中止時 | 中止報告・撤退報告 |

### 戦果評価報告の構成

```
# Phase {N} 戦果評価報告
電番: EVAL-PHASE{N}-YYYYMMDD

一、作戦概要
   - 作戦名、副題、期間、状態

二、作戦目標達成度
   - 各目標の達成/未達成
   - 達成率（%）

三、成果物一覧
   - 実装成果（ファイル、機能）
   - アセット成果
   - ツール成果
   - ドキュメント成果

四、技術的成果
   - 解決した技術課題
   - 発見した知見

五、問題と解決
   - 発生した重大問題
   - 問題解決プロセス
   - 所要時間

六、工数実績
   - 計画 vs 実績
   - 超過/節約の原因

七、教訓・改善点
   - 技術的教訓
   - プロセス的教訓
   - AGSP運用教訓

八、貢献者評価
   - 各役職の貢献内容
   - 殊勲者（特筆すべき貢献）

九、次フェーズへの引継ぎ事項
   - 技術的負債
   - 未実装機能
   - リスク

十、総括
   - 最終評価（成功/一部成功/失敗）
```

### 報告フロー

```
【Step 1】連合艦隊がフェーズ完了報告（SITREP）
           ↓
【Step 2】参謀総長が戦果評価報告を作成
           ↓
【Step 3】幕僚長が戦果評価を確認・承認
           ↓
【Step 4】strategy.yaml を更新（フェーズ完了反映）
           ↓
【Step 5】戦果評価報告を docs/strategy/ に保存
           ↓
【Step 6】次フェーズの計画策定または作戦終了
```

### ファイル命名規則

| ファイル種別 | 命名規則 | 例 |
|--------------|----------|----|
| 戦果評価報告 | `EVAL-PHASE{N}-YYYYMMDD.md` | `EVAL-PHASE3-20260201.md` |
| フェーズ計画書 | `PLAN-PHASE{N}-YYYYMMDD.md` | `PLAN-PHASE4-20260201.md` |
| 申し送り事項 | `HANDOVER-PHASE{N}-YYYYMMDD.md` | `HANDOVER-PHASE5-20260201.md` |

### 保存場所

```
docs/strategy/
├── strategy.yaml           # 統合作戦命令書
├── EVAL-PHASE1-YYYYMMDD.md # Phase 1 戦果評価
├── EVAL-PHASE2-YYYYMMDD.md # Phase 2 戦果評価
├── EVAL-PHASE3-YYYYMMDD.md # Phase 3 戦果評価
├── PLAN-PHASE4-YYYYMMDD.md # Phase 4 計画書
└── HANDOVER-PHASE5-YYYYMMDD.md # Phase 5 申し送り
```

### 幕僚長の確認事項

| 確認項目 | 内容 |
|----------|------|
| 目標達成度 | 当初の成功基準を満たしているか |
| 工数妥当性 | 超過がある場合、その原因は妥当か |
| 教訓の記録 | 再発防止策が明記されているか |
| 引継ぎ事項 | 次フェーズで対応すべき事項が明確か |
| 貢献者評価 | 殊勲者がいる場合、その貢献は正当に評価されているか |

---

## 核心原則 (Core Philosophy)

1. **No STRATEGY, No SPEC**: 公文書に基づかない作戦行動は無効
2. **Single Source of Truth**: 真実は常にドキュメントにあり
3. **Separation of Concerns**: 「考えるAI」と「動くAI」を混ぜてはならない
4. **Fleet Autonomy**: 方面軍は独立して作戦行動を取る
5. **Parallel Execution**: git worktreeによる並列実行で効率化
6. **Direct Command for Creation**: 制作作業は幕僚長が直接指揮する

---

## バージョン履歴

| Version | Date | Changes |
|---------|------|---------|
| v3.2.2 | 2026-02-01 | アセット特務部隊（幕僚長直轄）追加、核心原則第6条追加 |
| v3.2.1 | 2026-01-31 | 参謀総長の役割境界明文化、仕様書記載ルール追加 |
| v3.2 | 2026-01-31 | Claude Desktop統合トリガー、ECC連携、コンパクション復帰スキル |
| v3.1 | 2026-01-31 | 参謀本部3AI体制、方面軍方式、並列実行対応、電報形式導入 |
| v3.0 | 2026-01-30 | Claude Code中心体制への移行 |
| v2.5 | 2025-01-30 | 公文書主義対応 |

---

## ライセンス

MIT License

---

以上
